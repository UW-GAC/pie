{% extends '__object_detail.html' %}
{% load core_tags %}

{% block head_title %}
  | {{ tagged_trait }} details
{% endblock head_title %}

{% block title %}
  <a href="{{ tagged_trait.trait.get_absolute_url }}">{{ tagged_trait.trait.i_trait_name }}</a> tagged with
  <a href="{{ tagged_trait.tag.get_absolute_url }}">{{ tagged_trait.tag.title }}</a>
{% endblock title %}

{% block subtitle %}
  tagged variable details
{% endblock subtitle %}

{% block detail_fields %}
  <dt>Tagged by</dt><dd>{{ tagged_trait.creator }}</dd>
  {% if show_dcc_review_info %}
    <dt>DCC status</dt><dd>{{ tagged_trait.dcc_review.get_status_display }}</dd>
    {% if tagged_trait.dcc_review.status != tagged_trait.dcc_review.STATUS_CONFIRMED %}
      <dt>DCC comment</dt><dd>{{ tagged_trait.dcc_review.comment }}</dd>
    {% endif %}
  {% endif %}
  {% if show_study_response_info %}
    <dt>Study response status</dt><dd>{{ tagged_trait.dcc_review.study_response.get_status_display }}</dd>
    {% if tagged_trait.dcc_review.study_response.status != tagged_trait.dcc_review.study_response.STATUS_AGREE %}
      <dt>Study comment</dt><dd>{{ tagged_trait.dcc_review.study_response.comment }}</dd>
    {% endif %}
  {% endif %}
{% endblock detail_fields %}


{% block after_panel %}

  {% include 'tags/_taggedtrait_info.html' with show_all_tags=False %}

  {% if show_dcc_review_add_button %}
    <a class="btn btn-primary" href="{% url 'tags:tagged-traits:pk:dcc-review:new' tagged_trait.pk %}" role="button">
        <span class="glyphicon glyphicon-sunglasses" aria-hidden="true"></span> Review this tagged variable
    </a>
  {% endif %}
  {% if show_dcc_review_update_button %}
    <a class="btn btn-warning" href="{% url 'tags:tagged-traits:pk:dcc-review:update' tagged_trait.pk %}" role="button">
        <span class="glyphicon glyphicon-sunglasses" aria-hidden="true"></span> Update DCC review
    </a>
  {% endif %}
  {% if show_study_response_add_button %}
    <a class="btn btn-primary" href="{% url 'tags:tagged-traits:pk:study-response:create:new' tagged_trait.pk %}" role="button">
      <span class="glyphicon glyphicon sunglasses" aria-hidden="true"></span> Add a study response
    </a>
  {% endif %}
  {% if show_study_response_update_button %}
    <a class="btn btn-warning" href="{% url 'tags:tagged-traits:pk:study-response:update' tagged_trait.pk %}" role="button">
      <span class="glyphicon glyphicon sunglasses" aria-hidden="true"></span> Update study response
    </a>
  {% endif %}
  {% if perms.tags.add_taggedtrait %}
    {% if user_is_study_tagger or request.user.is_staff %}
      {% if not tagged_trait.dcc_review %}
        {% comment %}
          This use of the taggedtrait delete URL can't have ?next={{ request.path }} after it because
          once the tagged trait is deleted the detail page won't exist.
        {% endcomment %}
        <a class="btn btn-danger" href="{% url 'tags:tagged-traits:pk:delete' tagged_trait.pk %}?next={{ request.path }}" role="button">
            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Remove tag
        </a>
      {% endif %}
    {% endif %}
  {% endif %}
{% endblock after_panel %}
